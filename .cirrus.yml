container:
  image: cirrusci/flutter:latest
  
android_build_task:
  pub_cache:
    folder: ~/.pub-cache
  build_script: flutter build apk
  apk_artifacts:
    path: "build/app/outputs/apk/release/app-release.apk"

ios_build_task:
  pub_cache:
    folder: ~/.pub-cache
  osx_instance:
    image: mojave-flutter
  build_script:
    - pod repo update
    - flutter build ios --no-codesign
  ipa_export_script:
    - cd ios
    - xcodebuild -workspace Runner.xcworkspace -scheme Runner -sdk iphoneos -configuration Release archive -archivePath $PWD/build/Runner.xcarchive
    - xcodebuild -exportArchive -archivePath $PWD/build/Runner.xcarchive -exportOptionsPlist exportOptions.plist -exportPath $PWD/build/Runner.ipa
  ipa_artifacts:
    path: "ios/build/Runner.ipa/Runner.ipa"